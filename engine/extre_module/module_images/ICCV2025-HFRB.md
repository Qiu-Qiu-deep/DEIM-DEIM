# HFRB模块

## 一、动机

### 现有方法的问题
1. **频率特征处理不当**：现有频率域方法（如傅里叶变换和小波变换方法）对频率特征进行统一处理，未能充分利用不同频率分量的独特特性，限制了恢复潜力[1][2][3]

2. **细节保留能力不足**：
   - 傅里叶方法虽然擅长捕获全局信息和增强整体亮度，但缺乏空间局部性，难以保留边缘和纹理等高频细节[2][3]
   - 现有小波方法未能充分发挥小波变换在空间局部性和细节增强方面的优势[3]

3. **高低频信息处理缺乏针对性**：大多数研究表明，图像的大部分信息存在于低频分量中，而高频细节在低光场景中不太敏感，但现有方法未能根据这一特性进行差异化处理[9]

### 提出模块的目的
设计层次化特征恢复块(HFRB)，针对小波频域特征的不同特性进行精确建模，实现：
- 准确恢复高频细节信息
- 鲁棒处理低频亮度和色彩信息
- 充分利用小波变换的空间局部性优势[3][8]

## 二、模块工作原理和核心思想

HFRB由三个核心子模块组成，采用"提取-增强-融合"的层次化处理策略[8]：

### 2.1 特征提取模块(FE) [8][9]

**核心思想**：根据小波域特性，对高低频分量采用不同的提取策略

**工作原理**：
1. **小波分解**：将输入图像分解为四个频率子带
   - L：低频分量（包含主要的亮度和色彩信息）
   - H、V、D：水平、垂直、对角高频分量（包含边缘和纹理细节）[8]

2. **差异化特征提取**：
   - **高频特征**：使用深度可分离卷积提取，配合三个方向对齐的卷积核（H-Conv、V-Conv、D-Conv）分别提取水平、垂直、对角特征[9]
   - **低频特征**：使用WTConv层，在不增加参数复杂度的情况下获得更大感受野，这对捕获低频信息至关重要[9]

3. **信息补偿机制**：通过交互方式补偿缺失信息，低频特征L'通过方向卷积为高频分量提供补充信息[9]

### 2.2 高频增强块(HFEB) [9]

**核心思想**：基于状态空间模型(SSM)设计高频Mamba(HF-Mamba)，采用与小波高频分量扫描顺序一致的2D选择性扫描模块

**工作原理**：
1. **HF-Mamba结构**：包含三个子模块
   - H-Mamba：处理水平高频分量
   - V-Mamba：处理垂直高频分量  
   - D-Mamba：处理对角高频分量[9]

2. **定制化扫描策略**：
   - 水平扫描使用H-2D-SSM
   - 垂直扫描使用V-2D-SSM
   - 对角扫描使用D-2D-SSM
   - 这种一致性扫描进一步增强了FE提取的高频特征的细节表示[9]

3. **处理流程**：层归一化(LN) → 视觉状态空间模块(VSSM)与残差连接 → 门控前馈网络增强通道信息流[9]

### 2.3 低频增强块(LFEB) [10]

**核心思想**：在高频分量引导下，使用快速傅里叶卷积处理需要大感受野的低频分量

**工作原理**：
1. **结构引导增强**：
   - 首先通过逆小波变换(IWT)重建频域图像：Ī_low = IWT{L', H̃L, ṼL, D̃L}
   - 增强后的高频分量指导低频分量的恢复[10]

2. **双残差块设计**：
   - **第一块**：使用5×5卷积扩大感受野获取局部空间上下文，配合SimpleGate机制确保高效信息流，最后用1×1卷积恢复特征维度
   - **第二块**：强调通道间相关性，通过1×1卷积将通道维度扩展4倍，经SimpleGate选择性保留重要特征后压缩回原始通道大小[10]

3. **全局上下文整合**：两个残差块均采用快速傅里叶卷积(FFC)，通过通道FFT在早期网络层整合全局上下文，实现更广的感受野[10]

### 2.4 层次化处理策略

HFRB在每个采样层之后应用，通过FE、HFEB、LFEB的协同工作，实现：
- 自适应提取小波频域特征
- 精确恢复高频细节
- 全面恢复低频信息
- 最终生成预测的增亮输出I_pre[8][10]

## 三、总结

HFRB模块通过"分而治之"的策略，针对小波变换的频域特性进行精细化建模：

1. **创新性**：首次提出针对小波高频分量的定制化Mamba扫描策略，突破了传统方法对频率特征统一处理的局限[9]

2. **有效性**：消融实验证明，移除HFEB导致PSNR从21.53 dB降至20.58 dB，移除LFEB更是降至20.41 dB，验证了各组件的关键作用[14]

3. **优势**：
   - 充分利用小波变换的空间局部性优势
   - 实现高频细节的精确恢复和低频信息的鲁棒处理
   - 在高频分量引导下优化低频恢复，确保增强的精确性[3][8][10]

4. **性能表现**：HFRB使CWNet在多个数据集上达到最优性能，同时保持较低的参数量(1.23M)和计算复杂度(11.3G FLOPs)[12][13]