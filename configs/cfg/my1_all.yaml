# 论文第一篇：小麦感知的密集检测器
# Wheat-Oriented Dense Detector with WAPK, DAQS, UGDR
# Baseline: D-FINE-n
# 
# 三个创新点：
# 1. WAPK (Wheat-Aware Poly Kernel): 替换backbone的标准卷积，用椭圆核捕获细长麦穗
# 2. DAQS (Density-Adaptive Query Sampling): 在decoder中动态生成query（需要修改decoder实现）
# 3. UGDR (Uncertainty-Guided Distribution Refinement): 训练时的损失函数（在训练配置中指定）

backbone:
  # [from, module, args]
  - [-1, StemBlock, [16, 16, True]] # 0-P2/4
  - [-1, HG_Stage, [16, 64, 1, 3, False, False, 3, True, 'se']] # 1-P2/4
  
  # 在P3层引入WAPK增强细长目标特征
  - [-1, WAPKBlock, [256, 1.0, "True"]]  # 2-P3/8 [out_channels, expansion, downsample]
  
  - [-1, HG_Stage, [64, 512, 2, 3, True, True, 5, True, 'se']]  # 3-P4/16
  
  # 在P4层也引入WAPK
  - [-1, WAPKBlock, [512, 1.0, "False"]]  # 4-P4/16
  
  - [-1, HG_Stage, [128, 1024, 1, 3, True, True, 5, True, 'se']] # 5-P5/32

encoder:
  - [4, ConvNormLayer_fuse, [128, 1, 1]] # 6-P4/16
  - [5, ConvNormLayer_fuse, [128, 1, 1]] # 7-P5/32

  - [-1, TransformerEncoderBlock, [8, 512, 0.1, "relu", 10000, False]] # 8-P5/32

  - [-1, ConvNormLayer_fuse, [128, 1, 1]] # 9
  - [-1, nn.Upsample, [None, 2, "nearest"]] # 10
  - [[-1, 6], Concat, []] # 11-P4/16
  - [-1, RepNCSPELAN4, [128, 256, 21, 2, False, 'silu']] # 12-P4/16

  - [-1, SCDown, [128, 3, 2, 'silu']] # 13-P5/32
  - [[-1, 9], Concat, []] # 14-P5/32
  - [-1, RepNCSPELAN4, [128, 256, 21, 2, False, 'silu']] # 15-P5/32

decoder:
  - [[12, 15], DFINETransformerWithDAQS, {"feat_strides":[16, 32], "hidden_dim": 128, "num_levels": 2, "num_layers": 3, "num_points": [6, 6], "dim_feedforward": 512, "enable_daqs": True, "daqs_hidden_dim": 64, "daqs_min_queries": 100, "daqs_max_queries": 800, "daqs_alpha": 2.0}]
